Test Report - 2025-12-30 15:16:56.898641
============================================================
Step: SOP Search
Time: 0.11s
Prompt: What to do if a server has high CPU usage? Find SOP.
Response: # =================================================================
# AWS AIOps Enterprise Standard Operating Procedures (SOP)
# =================================================================

# 1. SYSTEM CLASSIFICATION & METADATA
# -----------------------------------------------------------------
# Role definitions based on instance tags for context-aware actions.
- ROLE_WEB: Tag:Name contains "Web", "Frontend", "Nginx", "Apache", "Was"
- ROLE_DB: Tag:Name contains "DB", "RDS", "Redis", "Mongo", "Elastic"
- ROLE_BATCH: Tag:Name contains "Batch", "Job", "Worker", "Airflow"
- ENV_PROD: Tag:Env contains "prod", "production", "live"
- ENV_DEV: Tag:Env contains "dev", "test", "stage"

# 2. INCIDENT RESPONSE RULES
# -----------------------------------------------------------------

[RULE_01: PROD_INSTANCE_DOWN]
- SEVERITY: P1 (Critical)
- CONDITION: (instance_state == 'stopped') AND (ENV_PROD is True)
- ACTION_TYPE: EC2_START
- COMMAND: null
- REASON: Production server is down. Immediate restart required to recover SLA. Notify Ops team immediately.

[RULE_02: DEV_INSTANCE_DOWN]
- SEVERITY: P3 (Low)
- CONDITION: (instance_state == 'stopped') AND (ENV_DEV is True)
- ACTION_TYPE: EC2_START
- COMMAND: null
- REASON: Development server found stopped. Auto-starting for developer convenience.

[RULE_03: MEMORY_OOM_KILLER_DETECTED]
- SEVERITY: P2 (High)
- CONDITION: logs contain "Out of memory" OR "Kill process" OR "Sacrificed child"
- ACTION_TYPE: ADVISE_SCALE_UP
- COMMAND: "dmesg | grep -i 'killed process' | tail -n 5"
- REASON: OOM Killer invoked. System is unstable. Do NOT restart blindly. Check logs for specific process memory leaks. Recommend changing Instance Type (Scale-up).

[RULE_04: WEB_SERVICE_Hang_OR_CRASH]
- SEVERITY: P2 (High)
- CONDITION: (ROLE_WEB is True) AND (logs contain "Connection refused" OR "502 Bad Gateway" OR "worker_connections are not enough")
- ACTION_TYPE: SSM_RUN
- COMMAND: "sudo nginx -t && sudo systemctl reload nginx || sudo systemctl restart nginx"
- REASON: Web service unreachable. Performing syntax check (-t) first. If passed, trying graceful reload. If failed, force restart.

[RULE_05: DISK_USAGE_CRITICAL_LOGS]
- SEVERITY: P2 (High)
- CONDITION: logs contain "No space left on device" OR "DiskFull"
- ACTION_TYPE: SSM_RUN
- COMMAND: "sudo journalctl --vacuum-time=2d && sudo find /var/log -name '*.gz' -mtime +30 -delete"
- REASON: Disk full prevented service write. Safely vacuuming systemd journals and deleting archived logs older than 30 days.

[RULE_06: HIGH_CPU_DIAGNOSIS]
- SEVERITY: P3 (Warning)
- CONDITION: cpu_usage > 90.0
- ACTION_TYPE: SSM_RUN
- COMMAND: "ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head -n 6"
- REASON: High CPU (>90%) detected. Executing process snapshot to identify the culprit process before deciding on reboot.

[RULE_07: ZOMBIE_PROCESS_STUCK]
- SEVERITY: P2 (High)
- CONDITION: logs contain "defunct" OR "zombie" OR "waiting for I/O"
- ACTION_TYPE: REBOOT_INSTANCE
- COMMAND: null
- REASON: System has high load due to zombie processes or I/O wait. Soft reboot is the safest way to clear the process table.

[RULE_08: SECURITY_BRUTE_FORCE]
- SEVERITY: P1 (Critical)
- CONDITION: logs contain "Invalid user" OR "Failed password" repeated > 10 times
- ACTION_TYPE: ADVISE_SECURITY
- COMMAND: "grep 'Failed password' /var/log/secure | awk '{print $(NF-3)}' | sort | uniq -c | sort -nr | head -5"
- REASON: Brute-force attack pattern detected. Running analysis command to identify attacker IP. Recommend updating Security Group immediately.

# 3. SAFETY & COMPLIANCE POLICIES
# -----------------------------------------------------------------
- SAFETY_1: [PROD] Never execute 'rm -rf' commands via automation. Use mv to /tmp or compression.
- SAFETY_2: [DB] Never auto-restart Database instances. Failover is handled by RDS/Cluster. Only alert.
- SAFETY_3: [SSM] All SSM commands must timeout after 60 seconds to prevent hanging agents.
----------------------------------------
Step: Create VPC
Time: 119.65s
Prompt: Create a VPC with cidr 10.50.0.0/16. Print the vpc id.
Response: [Result]
❌ Code Execution Error: closing parenthesis ']' does not match opening parenthesis '(' (<string>, line 2)
----------------------------------------
Step: Create Subnet
Time: 274.37s
Prompt: Create a subnet in 'None' with cidr 10.50.1.0/24. Print the subnet id.
Response: [Result]
❌ Code Execution Error: name 'vpc_cidr' is not defined
----------------------------------------
Step: Create SG
Time: 237.57s
Prompt: Create a security group in 'None' named 'E2E-SG'. Print the group id.
Response: [Result]
❌ Code Execution Error: Unknown service: 'security-group'. Valid service names are: accessanalyzer, account, acm, acm-pca, aiops, amp, amplify, amplifybackend, amplifyuibuilder, apigateway, apigatewaymanagementapi, apigatewayv2, appconfig, appconfigdata, appfabric, appflow, appintegrations, application-autoscaling, application-insights, application-signals, applicationcostprofiler, appmesh, apprunner, appstream, appsync, arc-region-switch, arc-zonal-shift, artifact, athena, auditmanager, autoscaling, autoscaling-plans, b2bi, backup, backup-gateway, backupsearch, batch, bcm-dashboards, bcm-data-exports, bcm-pricing-calculator, bcm-recommended-actions, bedrock, bedrock-agent, bedrock-agent-runtime, bedrock-agentcore, bedrock-agentcore-control, bedrock-data-automation, bedrock-data-automation-runtime, bedrock-runtime, billing, billingconductor, braket, budgets, ce, chatbot, chime, chime-sdk-identity, chime-sdk-media-pipelines, chime-sdk-meetings, chime-sdk-messaging, chime-sdk-voice, cleanrooms, cleanroomsml, cloud9, cloudcontrol, clouddirectory, cloudformation, cloudfront, cloudfront-keyvaluestore, cloudhsm, cloudhsmv2, cloudsearch, cloudsearchdomain, cloudtrail, cloudtrail-data, cloudwatch, codeartifact, codebuild, codecatalyst, codecommit, codeconnections, codedeploy, codeguru-reviewer, codeguru-security, codeguruprofiler, codepipeline, codestar-connections, codestar-notifications, cognito-identity, cognito-idp, cognito-sync, comprehend, comprehendmedical, compute-optimizer, compute-optimizer-automation, config, connect, connect-contact-lens, connectcampaigns, connectcampaignsv2, connectcases, connectparticipant, controlcatalog, controltower, cost-optimization-hub, cur, customer-profiles, databrew, dataexchange, datapipeline, datasync, datazone, dax, deadline, detective, devicefarm, devops-guru, directconnect, discovery, dlm, dms, docdb, docdb-elastic, drs, ds, ds-data, dsql, dynamodb, dynamodbstreams, ebs, ec2, ec2-instance-connect, ecr, ecr-public, ecs, efs, eks, eks-auth, elasticache, elasticbeanstalk, elastictranscoder, elb, elbv2, emr, emr-containers, emr-serverless, entityresolution, es, events, evidently, evs, finspace, finspace-data, firehose, fis, fms, forecast, forecastquery, frauddetector, freetier, fsx, gamelift, gameliftstreams, geo-maps, geo-places, geo-routes, glacier, globalaccelerator, glue, grafana, greengrass, greengrassv2, groundstation, guardduty, health, healthlake, iam, identitystore, imagebuilder, importexport, inspector, inspector-scan, inspector2, internetmonitor, invoicing, iot, iot-data, iot-jobs-data, iot-managed-integrations, iotanalytics, iotdeviceadvisor, iotevents, iotevents-data, iotfleetwise, iotsecuretunneling, iotsitewise, iotthingsgraph, iottwinmaker, iotwireless, ivs, ivs-realtime, ivschat, kafka, kafkaconnect, kendra, kendra-ranking, keyspaces, keyspacesstreams, kinesis, kinesis-video-archived-media, kinesis-video-media, kinesis-video-signaling, kinesis-video-webrtc-storage, kinesisanalytics, kinesisanalyticsv2, kinesisvideo, kms, lakeformation, lambda, launch-wizard, lex-models, lex-runtime, lexv2-models, lexv2-runtime, license-manager, license-manager-linux-subscriptions, license-manager-user-subscriptions, lightsail, location, logs, lookoutequipment, m2, machinelearning, macie2, mailmanager, managedblockchain, managedblockchain-query, marketplace-agreement, marketplace-catalog, marketplace-deployment, marketplace-entitlement, marketplace-reporting, marketplacecommerceanalytics, mediaconnect, mediaconvert, medialive, mediapackage, mediapackage-vod, mediapackagev2, mediastore, mediastore-data, mediatailor, medical-imaging, memorydb, meteringmarketplace, mgh, mgn, migration-hub-refactor-spaces, migrationhub-config, migrationhuborchestrator, migrationhubstrategy, mpa, mq, mturk, mwaa, mwaa-serverless, neptune, neptune-graph, neptunedata, network-firewall, networkflowmonitor, networkmanager, networkmonitor, notifications, notificationscontacts, nova-act, oam, observabilityadmin, odb, omics, opensearch, opensearchserverless, organizations, osis, outposts, panorama, partnercentral-account, partnercentral-benefits, partnercentral-channel, partnercentral-selling, payment-cryptography, payment-cryptography-data, pca-connector-ad, pca-connector-scep, pcs, personalize, personalize-events, personalize-runtime, pi, pinpoint, pinpoint-email, pinpoint-sms-voice, pinpoint-sms-voice-v2, pipes, polly, pricing, proton, qapps, qbusiness, qconnect, quicksight, ram, rbin, rds, rds-data, redshift, redshift-data, redshift-serverless, rekognition, repostspace, resiliencehub, resource-explorer-2, resource-groups, resourcegroupstaggingapi, rolesanywhere, route53, route53-recovery-cluster, route53-recovery-control-config, route53-recovery-readiness, route53domains, route53globalresolver, route53profiles, route53resolver, rtbfabric, rum, s3, s3control, s3outposts, s3tables, s3vectors, sagemaker, sagemaker-a2i-runtime, sagemaker-edge, sagemaker-featurestore-runtime, sagemaker-geospatial, sagemaker-metrics, sagemaker-runtime, savingsplans, scheduler, schemas, sdb, secretsmanager, security-ir, securityhub, securitylake, serverlessrepo, service-quotas, servicecatalog, servicecatalog-appregistry, servicediscovery, ses, sesv2, shield, signer, signin, simspaceweaver, sms-voice, snow-device-management, snowball, sns, socialmessaging, sqs, ssm, ssm-contacts, ssm-guiconnect, ssm-incidents, ssm-quicksetup, ssm-sap, sso, sso-admin, sso-oidc, stepfunctions, storagegateway, sts, supplychain, support, support-app, swf, synthetics, taxsettings, textract, timestream-influxdb, timestream-query, timestream-write, tnb, transcribe, transfer, translate, trustedadvisor, verifiedpermissions, voice-id, vpc-lattice, waf, waf-regional, wafv2, wellarchitected, wickr, wisdom, workdocs, workmail, workmailmessageflow, workspaces, workspaces-instances, workspaces-thin-client, workspaces-web, xray
----------------------------------------
Step: Create S3
Time: 300.69s
Prompt: Create an S3 bucket named 'e2e-test-e6bb83' in ap-northeast-2. Print 'Success'.
Response: [Result]
❌ Code Execution Error: Parameter validation failed:
Invalid type for parameter VpcId, value: {'Vpc': {'OwnerId': '956959051423', 'InstanceTenancy': 'default', 'Ipv6CidrBlockAssociationSet': [], 'CidrBlockAssociationSet': [{'AssociationId': 'vpc-cidr-assoc-027f669e7dd595c96', 'CidrBlock': '10.0.0.0/16', 'CidrBlockState': {'State': 'associated'}}], 'IsDefault': False, 'VpcId': 'vpc-0c207f10803335303', 'State': 'pending', 'CidrBlock': '10.0.0.0/16', 'DhcpOptionsId': 'dopt-0ed7ae87e62898d67'}, 'ResponseMetadata': {'RequestId': '6334577d-e390-4785-9dcc-7dc2e4e8cad7', 'HTTPStatusCode': 200, 'HTTPHeaders': {'x-amzn-requestid': '6334577d-e390-4785-9dcc-7dc2e4e8cad7', 'cache-control': 'no-cache, no-store', 'strict-transport-security': 'max-age=31536000; includeSubDomains', 'content-type': 'text/xml;charset=UTF-8', 'content-length': '692', 'date': 'Tue, 30 Dec 2025 06:32:29 GMT', 'server': 'AmazonEC2'}, 'RetryAttempts': 0}}, type: <class 'dict'>, valid types: <class 'str'>
----------------------------------------
